# Superpowers 项目详细调研报告

## 1. 项目概述

Superpowers 是一个为 AI 编码助手（如 Claude Code、Codex、OpenCode）构建的完整软件开发工作流系统。它通过一套可组合的"技能"（skills）系统，强制执行经过验证的最佳实践和工程模式。

### 基本信息
- **项目名称**: Superpowers
- **当前版本**: v4.3.0 (2026-02-12)
- **作者**: Jesse Vincent (jesse@fsck.com)
- **许可证**: MIT
- **GitHub**: https://github.com/obra/superpowers
- **支持平台**: Claude Code、Codex、OpenCode

## 2. 完整目录结构

```
superpowers/
├── .claude-plugin/                 # Claude Code 插件配置
│   ├── marketplace.json            # 市场place配置
│   └── plugin.json                # 插件元数据
├── .codex/                        # Codex 集成配置
│   └── INSTALL.md                 # Codex 安装说明
├── .github/
│   └── FUNDING.yml               # 赞助信息
├── .gitattributes                # Git 属性配置
├── .gitignore                    # Git 忽略文件
├── .opencode/                     # OpenCode 集成配置
│   ├── plugins/
│   │   └── superpowers.js        # OpenCode 插件实现
│   └── INSTALL.md                 # OpenCode 安装说明
├── hooks/                         # 钩子脚本
│   ├── hooks.json                 # 钩子配置
│   ├── run-hook.cmd              # Windows 钩子运行器
│   └── session-start.sh          # 会话启动钩子
├── lib/                          # 核心库
│   └── skills-core.js            # 技能系统核心实现
├── LICENSE                       # MIT 许可证
├── README.md                     # 项目主文档
├── RELEASE-NOTES.md              # 版本发布说明
├── commands/                     # 命令文档
│   ├── brainstorm.md            # 头脑风暴命令
│   ├── execute-plan.md          # 执行计划命令
│   └── write-plan.md            # 编写计划命令
├── docs/                        # 文档目录
│   ├── plans/                   # 规划文档
│   ├── README.codex.md          # Codex 文档
│   ├── README.opencode.md       # OpenCode 文档
│   ├── testing.md               # 测试文档
│   └── windows/                 # Windows 特定文档
├── skills/                      # 技能库（核心组件）
│   ├── brainstorming/           # 头脑风暴技能
│   ├── dispatching-parallel-agents/  # 并行代理分发
│   ├── executing-plans/         # 执行计划
│   ├── finishing-a-development-branch/  # 完成开发分支
│   ├── receiving-code-review/   # 接收代码审查
│   ├── requesting-code-review/  # 请求代码审查
│   ├── subagent-driven-development/  # 子代理驱动开发
│   ├── systematic-debugging/    # 系统化调试
│   ├── test-driven-development/ # 测试驱动开发
│   ├── using-git-worktrees/     # 使用 Git worktrees
│   ├── using-superpowers/       # 使用 Superpowers
│   ├── verification-before-completion/  # 完成前验证
│   ├── writing-plans/           # 编写计划
│   └── writing-skills/         # 编写技能
└── tests/                       # 测试套件
```

## 3. 核心架构设计

### 3.1 技能系统架构

Superpowers 的核心是一个基于文档的技能系统，每个技能都是一个 Markdown 文件（SKILL.md），包含：

1. **YAML 前置元数据**：
   ```yaml
   name: skill-name
   description: "Use when [condition] - [what it does]"
   ```

2. **技能内容**：结构化的工作流程、指南和最佳实践

3. **核心特性**：
   - 自动发现和加载
   - 技能触发机制
   - 技能间依赖关系
   - 个人技能与系统技能的优先级管理

### 3.2 技能发现机制

`skills-core.js` 实现了技能发现的核心逻辑：

```javascript
// 技能发现流程
function findSkillsInDir(dir, sourceType, maxDepth = 3) {
    // 递归搜索目录，查找所有 SKILL.md 文件
    // 支持深度限制，避免过度递归
}

// 技能解析（处理前置元数据）
function extractFrontmatter(filePath) {
    // 解析 YAML frontmatter，提取 name 和 description
}

// 技能路径解析（处理技能阴影）
function resolveSkillPath(skillName, superpowersDir, personalDir) {
    // 个人技能覆盖系统技能
    // 支持命名空间前缀（superpowers:）
}
```

### 3.3 钩子系统

钩子系统在会话启动时注入 Superpowers 上下文：

```json
// hooks/hooks.json
{
  "hooks": {
    "SessionStart": [
      {
        "matcher": "startup|resume|clear|compact",
        "type": "command",
        "command": "${CLAUDE_PLUGIN_ROOT}/hooks/session-start.sh"
      }
    ]
  }
}
```

## 4. 技能系统工作原理

### 4.1 技能触发机制

技能通过自然语言描述自动触发。每个技能的 `description` 字段使用 "Use when..." 格式，明确说明触发条件：

```yaml
name: brainstorming
description: "You MUST use this before any creative work - creating features, building components, adding functionality, or modifying behavior."
```

### 4.2 技能加载流程

1. **会话启动**：`session-start.sh` 注入 `using-superpowers` 技能内容
2. **技能发现**：根据描述匹配，加载相关技能
3. **技能执行**：按照技能定义的流程执行
4. **技能验证**：确保技能被正确遵循

### 4.3 技能优先级

- 个人技能（`~/.claude/skills/`）优先级高于系统技能
- 支持显式命名空间（`superpowers:some-skill`）强制使用系统技能
- 技能阴影机制允许用户覆盖系统默认行为

## 5. 核心技能分析

### 5.1 brainstorming（头脑风暴）

**功能**：在开始任何创造性工作之前强制进行设计和需求分析

**核心特点**：
- **硬性关卡**：不允许直接使用实现技能
- **强制清单**：必须完成6个特定步骤
- **流程图**：使用 Graphviz 定义明确的工作流程
- **反模式警告**：防止"This is too simple to need a design"的理性化

**工作流程**：
1. 探索项目上下文
2. 提出澄清问题（一次一个）
3. 提出2-3种方法及权衡
4. 分部分呈现设计并获得批准
5. 编写设计文档并提交
6. 转到实现阶段

### 5.2 writing-plans（编写计划）

**功能**：将设计文档转换为详细的实施计划

**核心特点**：
- **任务粒度**：每个步骤2-5分钟（RED-GREEN-REFACTOR）
- **完整文件路径**：精确到每个文件
- **测试驱动**：强制 TDD 流程
- **执行选项**：提供子代理驱动或并行会话两种执行方式

### 5.3 test-driven-development（测试驱动开发）

**功能**：强制执行严格的 TDD 流程

**核心原则**：
- **铁律**：没有失败的测试，不允许写生产代码
- **RED-GREEN-REFACTOR**：完整的循环
- **零例外**：不允许任何"这次例外"的理性化

**关键特性**：
- 必须亲眼看到测试失败
- 必须编写最小化的代码
- 必须每次提交代码
- 详细的反模式指南

### 5.4 systematic-debugging（系统化调试）

**功能**：系统化的调试方法，防止随机修复

**核心原则**：
- **铁律**：没有根因调查，不允许修复
- **四阶段流程**：
  1. 根因调查
  2. 模式分析
  3. 假设和测试
  4. 实施和验证

### 5.5 subagent-driven-development（子代理驱动开发）

**功能**：通过独立的子代理执行实现计划

**核心特点**：
- **新鲜子代理**：每个任务使用新的子代理
- **两阶段审查**：规范符合性审查，然后代码质量审查
- **上下文隔离**：避免上下文污染
- **快速迭代**：任务间不需要人工干预

### 5.6 其他重要技能

| 技能 | 功能 | 核心价值 |
|------|------|----------|
| **dispatching-parallel-agents** | 并行处理多个独立任务 | 加速问题解决 |
| **verification-before-completion** | 完成前必须验证 | 防止虚假完成声明 |
| **using-git-worktrees** | 使用隔离的工作环境 | 保护主分支 |
| **finishing-a-development-branch** | 完成开发分支流程 | 正确的合并/PR决策 |
| **requesting-code-review** & **receiving-code-review** | 代码审查协作 | 提高代码质量 |
| **writing-skills** | 创建新技能的指南 | 扩展能力 |

---

## 6. 优点分析

### 6.1 架构优点

| 优点 | 说明 |
|------|------|
| **基于文档的技能系统** | 使用 Markdown 文件定义技能，易于阅读、编辑和版本控制 |
| **平台无关设计** | 支持 Claude Code、Codex、OpenCode 多个平台 |
| **技能可组合** | 技能之间可以相互依赖和调用，形成复杂工作流 |
| **个人技能覆盖** | 允许用户用个人技能覆盖系统默认行为 |
| **自动发现机制** | 技能通过 description 自动触发，无需显式配置 |

### 6.2 工程实践优点

| 优点 | 说明 |
|------|------|
| **强制最佳实践** | 通过"铁律"和"硬性关卡"确保流程被正确执行 |
| **TDD 内置** | 测试驱动开发是核心技能，不是可选项 |
| **系统化调试** | 防止随机修复，要求根因分析 |
| **验证驱动** | 完成前必须验证，防止虚假完成声明 |
| **代码审查流程** | 完整的请求/接收代码审查机制 |

### 6.3 效率优点

| 优点 | 说明 |
|------|------|
| **并行代理** | 支持独立任务并行处理 |
| **子代理隔离** | 每个任务使用新鲜子代理，避免上下文污染 |
| **自动化工作流** | 从设计到实现到审查的完整自动化 |
| **减少决策疲劳** | 明确的流程减少需要做出的决策 |

### 6.4 可扩展性优点

| 优点 | 说明 |
|------|------|
| **技能创建指南** | `writing-skills` 技能帮助创建新技能 |
| **钩子系统** | 支持自定义钩子扩展行为 |
| **插件架构** | 每个平台有独立的插件实现 |
| **命名空间支持** | 避免技能名称冲突 |

---

## 7. 缺点分析

### 7.1 架构缺点

| 缺点 | 说明 |
|------|------|
| **平台适配复杂** | 需要为每个平台维护独立的插件实现 |
| **技能发现依赖字符串匹配** | description 匹配可能不够精确，导致错误触发或漏触发 |
| **缺乏技能版本控制** | 技能更新可能导致不兼容，没有版本管理机制 |
| **全局状态依赖** | 钩子系统依赖全局环境变量，在复杂环境中可能出问题 |
| **定制化困难** | 技能内容硬编码在 SKILL.md 中，用户难以根据项目特点灵活调整工作流程；要修改必须创建完整的覆盖文件 |
| **缺乏统一进度管理** | 没有跨会话的进度追踪机制，任务状态无法持久化；无法查看整体任务完成度、阻塞点等关键信息 |

### 7.1.1 定制化问题详解

**问题描述**：Superpowers 的技能系统缺乏灵活的定制化能力，主要体现在：

1. **全有或全无**：技能要么使用默认版本，要么创建完整的覆盖文件，无法只修改部分内容
2. **缺乏配置层**：没有 JSON/YAML 配置文件让用户调整技能参数（如 TDD 的严格程度、brainstorming 的步骤等）
3. **项目级定制困难**：个人技能是全局的，无法针对不同项目使用不同的技能配置
4. **模板不可调**：工作流程中的模板（如设计文档格式、计划模板）硬编码在技能中

**影响**：
- 团队无法根据自己的工作流程调整技能
- 不同项目无法使用不同的实践标准
- 强制执行的标准可能与团队文化冲突

### 7.1.2 进度管理问题详解

**问题描述**：Superpowers 缺乏统一的任务进度管理机制，具体问题：

1. **无持久化状态**：每次会话都是独立的，之前的任务进度无法恢复
2. **缺乏可视化**：没有看板、甘特图或任何形式的进度可视化
3. **无任务追踪**：不知道哪些任务完成、哪些阻塞、哪些待处理
4. **跨会话断裂**：执行计划时如果中断，无法从断点继续
5. **缺乏度量**：没有时间估算、实际耗时、完成率等度量指标

**对比其他工具**：
| 功能 | Superpowers | 传统项目管理工具 |
|------|-------------|-----------------|
| 任务状态持久化 | 无 | 有 |
| 进度可视化 | 无 | 看板/甘特图 |
| 跨会话恢复 | 无 | 有 |
| 团队协作视图 | 无 | 有 |
| 度量和报表 | 无 | 有 |

### 7.2 使用体验缺点

| 缺点 | 说明 |
|------|------|
| **学习曲线陡峭** | 14个核心技能，每个都有复杂的工作流程 |
| **流程可能过于严格** | 对于简单任务，完整的 TDD/头脑风暴流程可能过度 |
| **强制执行可能令人沮丧** | "铁律"机制可能导致用户体验不佳 |
| **技能触发不透明** | 用户可能不清楚为什么某个技能被触发或未被触发 |

### 7.3 技术缺点

| 缺点 | 说明 |
|------|------|
| **缺乏测试框架** | 技能本身的质量保证依赖人工审查 |
| **调试困难** | 技能执行失败时，错误信息可能不够清晰 |
| **Windows 支持不完善** | 需要 polyglot 钩子，体验可能不如 Unix |
| **缺乏性能监控** | 没有技能执行性能的监控和优化机制 |

### 7.4 维护缺点

| 缺点 | 说明 |
|------|------|
| **技能数量增长** | 随着技能数量增加，维护成本会线性增长 |
| **技能间依赖复杂** | 技能之间的依赖关系可能导致级联更新 |
| **文档同步** | README、技能文档、命令文档需要保持同步 |
| **向后兼容性** | 技能更新可能破坏现有工作流 |

### 7.5 潜在风险

| 风险 | 说明 |
|------|------|
| **过度依赖** | 用户可能过度依赖系统，失去独立思考能力 |
| **技能冲突** | 多个技能可能对同一场景有不同的处理方式 |
| **上下文膨胀** | 大量技能内容注入可能导致 token 消耗增加 |
| **安全考虑** | 钩子脚本执行需要信任，可能存在安全风险 |

---

## 8. 改进建议

### 8.1 短期改进

1. **改进技能触发机制**：使用更精确的匹配算法，减少误触发
2. **增加技能热重载**：允许在不重启会话的情况下更新技能
3. **改进错误信息**：提供更清晰的错误提示和恢复建议
4. **增加技能调试模式**：帮助开发者理解技能执行流程
5. **引入技能配置层**：支持 `skill.config.yaml` 让用户自定义技能参数
6. **添加任务状态持久化**：将任务进度保存到 `.superpowers/state.json`

### 8.1.1 针对定制化问题的改进建议

**引入分层配置系统**：
```
project/
├── .superpowers/
│   ├── config.yaml          # 项目级配置
│   ├── overrides/           # 项目级技能覆盖
│   └── templates/           # 自定义模板
```

**配置示例**：
```yaml
# .superpowers/config.yaml
skills:
  brainstorming:
    enabled: true
    strictness: relaxed  # relaxed | normal | strict
    required_steps: [explore, design]  # 可选步骤
  test-driven-development:
    enabled: true
    auto_commit: false
  verification-before-completion:
    commands:
      - npm test
      - npm run lint
```

### 8.1.2 针对进度管理问题的改进建议

**引入进度追踪系统**：
```
.superpowers/
├── state.json              # 当前状态
├── history/                # 历史记录
│   └── 2026-02-18.json
└── dashboard.html          # 进度可视化（可选）
```

**状态文件示例**：
```json
{
  "current_plan": "feature-auth",
  "tasks": [
    {
      "id": "task-1",
      "title": "实现登录 API",
      "status": "completed",
      "started_at": "2026-02-18T10:00:00Z",
      "completed_at": "2026-02-18T11:30:00Z"
    },
    {
      "id": "task-2",
      "title": "添加登录表单",
      "status": "in_progress",
      "started_at": "2026-02-18T11:35:00Z"
    }
  ],
  "progress": {
    "total": 5,
    "completed": 1,
    "in_progress": 1,
    "pending": 3
  }
}
```

### 8.2 中期改进

1. **技能版本控制**：引入语义化版本管理
2. **技能性能监控**：跟踪技能执行时间和 token 消耗
3. **智能技能推荐**：基于上下文推荐相关技能
4. **技能测试框架**：允许为技能编写自动化测试

### 8.3 长期改进

1. **技能市场**：允许社区贡献和分享技能
2. **可视化工作流**：提供图形界面展示技能执行流程
3. **AI 辅助技能生成**：使用 AI 帮助生成和优化技能
4. **跨会话记忆**：支持跨会话的技能学习和发展

---

## 9. Supercraft：解决 Superpowers 痛点的下一代方案

### 9.1 项目背景

**Supercraft** 的诞生正是为了解决 Superpowers 存在的核心痛点：

| Superpowers 的痛点 | Supercraft 的解决方案 |
|-------------------|----------------------|
| 定制化困难：技能硬编码，无法灵活调整 | **可配置的技能系统**：支持项目级配置和模板定制 |
| 无进度管理：跨会话状态丢失，无任务追踪 | **统一进度管理**：任务状态持久化、可视化进度、跨会话恢复 |
| 全局技能：无法针对不同项目使用不同配置 | **项目隔离**：每个项目独立的配置和状态 |
| 模板不可调：工作流程模板硬编码 | **模板系统**：可自定义设计文档、计划等模板 |

### 9.2 Supercraft 的核心定位

Supercraft 不仅仅是 Superpowers 的"增强版"，而是一个重新设计的 AI 辅助开发工作流系统：

1. **继承优点**：保留 Superpowers 的最佳实践（TDD、系统化调试、代码审查等）
2. **解决痛点**：补齐定制化和进度管理的能力
3. **更友好的体验**：降低学习曲线，提供更灵活的工作流

### 9.3 Supercraft 的设计目标

```
┌─────────────────────────────────────────────────────────────┐
│                      Supercraft                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │  最佳实践    │  │  灵活配置    │  │    进度管理          │  │
│  │  (继承 SP)   │  │  (新能力)    │  │    (新能力)          │  │
│  └─────────────┘  └─────────────┘  └─────────────────────┘  │
│                                                              │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                    统一的工作流引擎                       │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

**核心能力**：

| 能力 | 说明 |
|------|------|
| **可配置技能** | 支持配置文件调整技能行为，无需覆盖整个技能 |
| **项目级隔离** | 每个项目独立的配置、状态、模板 |
| **进度持久化** | 任务状态保存，支持跨会话恢复 |
| **可视化进度** | 提供看板、进度条等可视化能力 |
| **模板系统** | 可自定义设计文档、实施计划等模板 |
| **团队协作** | 支持团队共享配置和查看进度 |

### 9.4 Supercraft vs Superpowers 对比

| 维度 | Superpowers | Supercraft |
|------|-------------|------------|
| **定制化** | 全有或全无 | 分层配置，细粒度调整 |
| **进度管理** | 无 | 完整的任务追踪系统 |
| **跨会话** | 状态丢失 | 状态持久化，断点恢复 |
| **项目隔离** | 全局配置 | 项目级独立配置 |
| **学习曲线** | 陡峭 | 渐进式，可从简单开始 |
| **团队协作** | 个人使用 | 支持团队共享和协作 |
| **模板** | 硬编码 | 可自定义 |

---

## 10. 总结

### 10.1 Superpowers 项目价值

Superpowers 是一个创新的 AI 辅助开发系统，它将隐性的最佳实践显式化、系统化，并通过 AI 的特性强制执行，从而显著提升软件开发的质效。

**核心价值**：
- 质量保证：强制 TDD 流程、系统化调试、完成前验证
- 效率提升：并行处理、子代理模式、自动化工作流
- 知识传承：显式的最佳实践文档、可复用的模式
- 风险控制：隔离的开发环境、根因调查要求

### 10.2 Superpowers 的核心缺陷

1. **定制化困难**：技能硬编码，无法根据项目特点灵活调整
2. **缺乏进度管理**：无跨会话状态持久化，无任务追踪和可视化

这两个缺陷严重限制了 Superpowers 在实际团队项目中的应用。

### 10.3 Supercraft 的意义

**Supercraft** 正是为解决这些问题而生，它：

1. **继承 Superpowers 的精华**：最佳实践、质量保证、工作流设计
2. **补齐关键能力**：灵活定制、进度管理、项目隔离
3. **提供更好的体验**：降低门槛、支持团队、渐进式采用

Supercraft 代表了 AI 辅助开发的下一个阶段——不仅要有强大的能力，还要有良好的可用性和适应性。

---

*报告生成时间：2026-02-18*
*调研人：Claude Code*
*Supercraft 项目地址：/Users/wangguiping/workspace/github/supercraft*
